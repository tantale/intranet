/*
 *  jQuery Worked Hours Grid plugin - v0.3.0
 *  jQuery plugin used to calculate worked durations in worked hours grids.
 *  http://github.com/tantale/jquery-worked-hours-grid
 *
 *  Made by Laurent LAPORTE
 *  Under MIT License
 */
!function(a,b,c,d){function e(b,c){this.element=b,this.grid=a(this.element),this.settings=a.extend(!0,{},g,c),this._defaults=g,this._name=f,this.init()}var f="workedHoursGrid",g={units:{hours:"h",minutes:"min",seconds:"s"},selectors:{row:".row",range:".range",start:".start",end:".end",sum:".sum",total:".total"}};e.prototype={init:function(){var b=this;this.grid.find(this.settings.selectors.start).change(function(){b.updateTotal(a(this))}),this.grid.find(this.settings.selectors.end).change(function(){b.updateTotal(a(this))}),this.refresh()},refresh:function(){this.grid.find(this.settings.selectors.row).find(this.settings.selectors.start+":first").change()},updateTotal:function(b){var c=this,d=b.closest(this.settings.selectors.range),e=d.closest(this.settings.selectors.row),f=e.find(this.settings.selectors.sum),g=this.grid.find(this.settings.selectors.total),h=new DeltaSum,i=new DeltaSum;e.find(this.settings.selectors.range).each(function(b,d){var e=a(d),f=e.find(c.settings.selectors.start),g=e.find(c.settings.selectors.end),i=new Delta(f.val(),g.val());h.append(i)}),a(f).text(h.toString(this.settings.units)),this.grid.find(this.settings.selectors.range).each(function(b,d){var e=a(d),f=e.find(c.settings.selectors.start),g=e.find(c.settings.selectors.end),h=new Delta(f.val(),g.val());i.append(h)}),a(g).text(i.toString(this.settings.units))}},a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})},ONE_SECOND=1e3,ONE_MINUTE=60*ONE_SECOND,ONE_HOUR=60*ONE_MINUTE,ONE_DAY=24*ONE_HOUR,Duration=function(a){var b=a;this.deltaTime=a,this.milliseconds=b%1e3,b=Math.floor(b/1e3),this.seconds=b%60,b=Math.floor(b/60),this.minutes=b%60,b=Math.floor(b/60),this.hours=b},Duration.prototype={toString:function(a){var b,c=[];return this.deltaTime>=ONE_HOUR&&(this.hours||this.minutes||this.seconds||this.milliseconds)&&c.push(this.hours+a.hours),this.deltaTime>=ONE_MINUTE&&(this.minutes||this.seconds||this.milliseconds)&&c.push(this.minutes+a.minutes),this.deltaTime>=ONE_SECOND&&(this.seconds||this.milliseconds)&&(b=this.seconds+this.milliseconds/1e3,c.push(b+a.seconds)),c.join(" ")}},Delta=function(a,b){this.startTime=0,this.endTime=0,this.deltaTime=0,this.init(a,b)},Delta.prototype={init:function(a,b){var c=new Date,d=c.toISOString().split("T")[0];this.startTime=Date.parse(d+"T"+a),this.endTime=Date.parse(d+"T"+b),this.startTime&&this.endTime?this.deltaTime=this.startTime<this.endTime?this.endTime-this.startTime:ONE_DAY+this.endTime-this.startTime:this.deltaTime=0},toString:function(a){var b=new Duration(this.deltaTime);return b.toString(a)}},DeltaSum=function(){this.deltas=[],this.deltaTime=0},DeltaSum.prototype={append:function(a){this.deltas.push(a),this.deltaTime=this.deltaTime+a.deltaTime},toString:function(a){var b=new Duration(this.deltaTime);return b.toString(a)}}}(jQuery,window,document);